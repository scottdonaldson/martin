<!DOCTYPE HTML>
<html>

<head>

    <title>Voronoi</title>
    <style>html, body { margin: 0; padding: 0; }</style>

    <script src="http://martinjs.org/download/martin.min.js"></script>
</head>

<body>

    <canvas id="canvas" width="600" height="600"></canvas>

    <script>

    var canvas = new Martin('canvas', init);

    function random(lower, upper) {
        return Math.floor(Math.random() * upper) + lower;
    }

    function randomPoint(canvas, points) {
        var point = [ random(0, canvas.width()), random(0, canvas.height()) ];
        points.push(point);
    }

    // simple distance calculator
    function distance(to, from) {
        var dx = to[0] - from[0],
            dy = to[1] - from[1];
        return Math.sqrt( dx * dx + dy * dy );
    }

    // map a number (i.e. 5) of a max (i.e. 10) to its hex value...
    function mapHex(val, max) {
        var output = Math.round(val * 16 / max);
        if ( output === 10 ) output = 'a';
        if ( output === 11 ) output = 'b';
        if ( output === 12 ) output = 'c';
        if ( output === 13 ) output = 'd';
        if ( output === 14 ) output = 'e';
        if ( output === 15 ) output = 'f';
        return output.toString();
    }

    function voronoi(canvas) {

        // set a new layer
        canvas.newLayer();

        var points = [],
            dist,
            indie,
            n,
            x,
            y,
            numPoints = 12;

        // put points on canvas
        for ( var i = 0; i < numPoints; i++ ) {
            randomPoint(canvas, points);
        }

        canvas.loop(function(x, y, pixel) {

            dist = 10000; // ridiculously high

            // loop through the points
            points.forEach(function(point, index){

                // if the distance from the current pixel to one of the points is
                // less than the set distance, set the new distance, the point index,
                // and set color values
                if ( distance([x, y], point) < dist ) {
                    indie = index;
                    dist = distance([x, y], point);

                    pixel.r = pixel.g = pixel.b = indie * 255 / numPoints;
                    pixel.a = 255;
                }
            });

            return pixel;
        });

        canvas.blur(1).opacity(0.6);
    }

    function init(canvas) {

        // Voronoi 10x
        for ( var i = 0; i < 10; i++) voronoi(canvas);

    }

    </script>
</body>
</html>
