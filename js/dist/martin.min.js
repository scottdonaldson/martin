!function(){function t(e,i){return this instanceof t?(this.original=null,"string"==typeof e?this.original=document.getElementById(e):e instanceof HTMLElement&&(this.original=e),this.options=i||{},this.makeCanvas()):new t(e,i)}function e(t,e){t&&t.forEach(e)}function i(){}function n(e,i){function n(n){var r=new t.Element(e,this,n);return r.renderElement=function(){var e=this.layer,n=this.context;this.clear(),n.scale(e.scale.x,e.scale.y),n.beginPath(),i.call(r,this.data),this.setContext(this.data),n.closePath(),n.scale(1/e.scale.x,1/e.scale.y),t.utils.forEach(this.effects,function(t){t.renderEffect&&t.renderEffect()}),e.context.drawImage(this.canvas,0,0)},r}t.prototype[e]=function(t){var e=n.call(this,t);return this.autorender(),e},t.Layer.prototype[e]=function(t){var e=n.call(this.base,t);return this.base.autorender(),e}}function r(t){this.context.drawImage(t,0,0)}function a(t){var e=this.layer,i=this.context;i.rect(e.normalizeX(t.x||0),e.normalizeY(t.y||0),e.normalizeX(t.width||e.width()),e.normalizeY(t.height||e.height()))}function s(e,i){function n(n,r,a){var s=new t.Effect(e,this,n,r,a);return s.renderEffect=function(){i.call(s,this.data)},s}t.prototype[e]=function(t){var e=n.call(this,t,this.currentLayer.effects,this.currentLayer);return this.autorender(),e},t.Layer.prototype[e]=t.Element.prototype[e]=function(t){var e=n.call(this.base,t,this.effects,this);return this.base.autorender(),e}}function o(t){this.context.loop(function(e,i,n){var r=n.r,a=n.g,s=n.b,o=.3*r+.59*a+.11*s;return r=(1-t)*r+t*o,a=(1-t)*a+t*o,s=(1-t)*s+t*o,n.r=r,n.g=a,n.b=s,n})}function h(t){this.context.loop(function(e,i,n){return n.r+=Math.round(255*t),n.g+=Math.round(255*t),n.b+=Math.round(255*t),n})}function c(){this.r=this.g=this.b=this.a=0,this.next=null}function l(t,e,i){return{exec:function(i){var n,r={};for(n in i)r[n]=i[n];r.x=i.offsetX?i.offsetX:i.clientX-t.canvas.getBoundingClientRect().left,r.y=i.offsetY?i.offsetY:i.clientY-t.canvas.getBoundingClientRect().top,e(r),t.autorender()}}}t.utils={},t.prototype.makeCanvas=function(){function e(){i.width=n.naturalWidth,i.height=n.naturalHeight,this.width(i.width),this.height(i.height),n.parentNode.insertBefore(i,n),n.parentNode.removeChild(n),t.registerElement("image",function(t){r.call(this,t)}),this.image(n)}if(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.newLayer(),this.original)if("IMG"===this.original.tagName){var i=this.canvas,n=(this.context,this.original);if(n.complete)return e.call(this);n.onload=e.bind(this)}else"CANVAS"===this.original.tagName&&(this.canvas=this.original,this.context=this.original.getContext("2d"));return this.autorender(),this},t._version="0.3.2",t.degToRad=function(t){return t*(Math.PI/180)},t.radToDeg=function(t){return t*(180/Math.PI)},t.hexToRGB=function(t){if(!t)return!1;"#"===t.slice(0,1)&&(t=t.slice(1));var e,i,n;return 6===t.length?(e=t.slice(0,2),i=t.slice(2,4),n=t.slice(4,6)):3===t.length&&(e=t.slice(0,1)+t.slice(0,1),i=t.slice(1,2)+t.slice(1,2),n=t.slice(2,3)+t.slice(2,3)),{r:parseInt(e,16),g:parseInt(i,16),b:parseInt(n,16)}},t.utils.forEach=e,t.utils.noop=i;var u,f={extend:function(e){for(var i in e){if(t.prototype.hasOwnProperty(i))throw new Error("Careful! This method already exists on the Martin prototype. Try a different name after checking the docs: http://martinjs.org");t.prototype[i]=e[i]}},remove:function(){var t=this.canvas,e=t.parentNode;return e&&e.removeChild(this.canvas),this},render:function(e){var i=this.context;return i.clearRect(0,0,this.width(),this.height()),t.utils.forEach(this.layers,function(e){e.clear(),t.utils.forEach(e.elements,function(t){t.renderElement&&t.renderElement()}),t.utils.forEach(e.effects,function(t){t.renderEffect&&t.renderEffect()}),i.drawImage(e.canvas,0,0)}),e?e():this},autorender:function(t){return this.options.autorender!==!1?this.render(t):t?t():null},toDataURL:function(){return this.canvas.toDataURL()},convertToImage:function(){var t=this.toDataURL(),e=document.createElement("img");e.src=t,this.layers.forEach(function(t,e){this.deleteLayer(e)},this),this.container&&this.container.appendChild(e)}};for(u in f)t.prototype[u]=f[u];t.Object=function(){};var d,p;d={loop:function(t,e){var i,n,r,a,s,o,h,c,l,u,f,d,p=this.base.width(),g=this.base.height();if(i=this.getImageData()){n=i.data,r=n.length;for(var y=0;r>y;y+=4)a=y/4,s=a%p,o=Math.floor(a/g),h=n[y],c=n[y+1],l=n[y+2],u=n[y+3],f={r:h,g:c,b:l,a:u},d=t.call(this.context,s,o,f),n[y]=d.r,n[y+1]=d.g,n[y+2]=d.b,n[y+3]=d.a;e!==!1&&this.putImageData(i)}return this},getImageData:function(){var t=this.context&&this.canvas.width>0&&this.canvas.height>0?this.context.getImageData(0,0,this.canvas.width,this.canvas.height):null;return t},putImageData:function(t){return this.context.putImageData(t,0,0),this},clear:function(){return this.context.clearRect(0,0,this.base.width(),this.base.height()),this},stackIndex:function(){return this.stack.indexOf(this)},remove:function(){return this.stack.splice(this.stackIndex(),1),this.base.autorender(),this},bump:function(t){var e=this.stackIndex();return this.remove(),this.stack.splice(e+t,0,this),this.base.autorender(),this},bumpUp:function(){return this.bump(1)},bumpDown:function(){return this.bump(-1)},bumpToTop:function(){return this.remove(),this.stack.push(this),this.base.autorender(),this},bumpToBottom:function(){return this.remove(),this.stack.unshift(this),this.base.autorender(),this}};for(p in d)t.Object.prototype[p]=d[p];t.Layer=function(t,e){if(this.base=t,this.canvas=document.createElement("canvas"),this.canvas.width=t.original?t.original.naturalWidth||t.original.width:t.width(),this.canvas.height=t.original?t.original.naturalHeight||t.original.height:t.height(),this.context=this.canvas.getContext("2d"),this.scale={x:1,y:1},this.elements=[],this.effects=[],this.base.layers||(this.base.layers=[]),this.stack=this.base.layers,this.stack.push(this),"string"==typeof e)this.type=e;else for(var i in e)this[i]=e[i];return this},t.Layer.prototype=Object.create(t.Object.prototype),t.Layer.prototype.normalizeX=function(t){return"string"==typeof t&&"%"===t.slice(-1)&&(t=this.normalizePercentX(+t.slice(0,-1))),t/this.scale.x},t.Layer.prototype.normalizeY=function(t){return"string"==typeof t&&"%"===t.slice(-1)&&(t=this.normalizePercentY(+t.slice(0,-1))),t/this.scale.y},t.Layer.prototype.normalizePercentX=function(t){return t/100*this.canvas.width},t.Layer.prototype.normalizePercentY=function(t){return t/100*this.canvas.height},t.prototype.newLayer=function(e){var i=new t.Layer(this,e);return this.currentLayer=i,this.autorender(),i},t.prototype.layer=function(t){return this.currentLayer=this.layers[t||0],this.layers[t||0]},t.registerElement=n,t.Element=function(t,e,i){var n=e.base||e,r=e.currentLayer||e;return this.base=n,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=n.original?n.original.naturalWidth||n.original.width:n.width(),this.canvas.height=n.original?n.original.naturalHeight||n.original.height:n.height(),this.scale={x:1,y:1},this.data=i||{},i.x&&(this.data.x=r.normalizeX(i.x)),i.y&&(this.data.y=r.normalizeY(i.y)),this.type=t,this.layer=r,this.effects=[],this.stack=this.layer.elements,this.stack.push(this),"background"===this.type&&(this.data={color:i},this.bumpToBottom()),this},t.Element.prototype=Object.create(t.Object.prototype),t.Element.prototype.setContext=function(t){var e=this.context;e.save(),e.fillStyle=t.color||"#000",e.fill(),e.scale(this.scale.x,this.scale.y),e.globalAlpha=t.alpha||1,e.lineWidth=t.strokeWidth?t.strokeWidth:0,e.lineCap=t.cap?t.cap:"square",e.strokeStyle=t.stroke?t.stroke:"transparent",e.stroke(),e.restore()},t.Element.prototype.update=function(t,e){var i,n;if(e)i=t,n=e,this.data[i]=n;else for(i in t)n=t[i],this.data[i]=n;this.base.autorender()},t.Element.prototype.moveTo=function(t,e){var i=this.data;return t=t||0,e=e||0,"line"===this.type?(i.endX+=t-i.x,i.endY+=e-i.y):"polygon"===this.type&&(i.points.forEach(function(n,r){if(r>0){var a=n[0],s=n[1];i.points[r]=[a+(t-i.points[0][0]),s+(e-i.points[0][1])]}}),i.points[0]=[t,e]),i.x=t,i.y=e,this.base.autorender(),this},n("image",function(t){r.call(this,t)}),n("rect",function(t){a.call(this,t)}),n("background",function(t){a.call(this,t)}),n("line",function(t){var e=this.layer,i=this.context;return i.moveTo(e.normalizeX(t.x||0),e.normalizeY(t.y||0)),i.lineTo(e.normalizeX(t.endX),e.normalizeY(t.endY)),t.strokeWidth||(t.strokeWidth=1),t.stroke=t.color?t.color:"#000",this}),n("circle",function(t){var e=this.layer,i=this.context,n=e.normalizeX(t.x||0),r=e.normalizeY(t.y||0);i.arc(n,r,t.radius,0,2*Math.PI,!1)}),n("ellipse",function(t){var e,i=this.layer,n=this.context,r=i.normalizeX(t.x||0),a=i.normalizeY(t.y||0);return t.radiusX>t.radiusY?(e=t.radiusX/t.radiusY,n.scale(e,1),n.arc(r/e,a,t.radiusX/e,0,2*Math.PI,!1),n.scale(1/e,1)):(e=t.radiusY/t.radiusX,n.scale(1,e),n.arc(r,a/e,t.radiusY/e,0,2*Math.PI,!1),n.scale(1,1/e)),this}),n("polygon",function(t){for(var e=this.layer,i=this.context,n=0;n<t.points.length;n++){var r=t.points[n][0],a=t.points[n][1],s=e.normalizeX(r),o=e.normalizeY(a);0===n&&i.moveTo(s,o),i.lineTo(s,o)}return i.lineTo(e.normalizeX(t.points[0][0]),e.normalizeY(t.points[0][1])),this}),n("text",function(t){function e(t,e,i){return(t?t+" ":"")+(e||16)+"px "+(i||"sans-serif")}var i,n,r,a,s=this.layer,o=this.context,h={};n=t.style||"",i=t.size||"",r=t.font||"",a=e(t.style,t.size,t.font),this.fontSize=function(t){return t?(this.data.size=t,t):this.data.size},this.fontStyle=function(t){return t?(this.data.style=t,t):this.data.style},this.font=function(t){return t?(this.data.font=t,t):this.data.style},this.width=function(){return o.measureText(t.text||"").width},Object.defineProperty(h,"theStyle",{get:function(){return n},set:function(i){a=e(i,t.size,t.font)}}),Object.defineProperty(h,"theSize",{get:function(){return i},set:function(i){a=e(t.style,i,t.font)}}),Object.defineProperty(h,"theFont",{get:function(){return r},set:function(i){a=e(t.style,t.size,i)}}),o.font=a,o.fillStyle=t.color||"#000",o.textBaseline="top",o.textAlign=t.align||"left",o.fillText(t.text||"",s.normalizeX(t.x||0),s.normalizeY(t.y||0))}),t.registerEffect=s,t.Effect=function(t,e,i,n,r){return this.base=e,this.type=t,this.data=i,this.context=r,this.stack=n,this.stack.push(this),this},t.Effect.prototype=Object.create(t.Object.prototype),t.Effect.prototype.increase=function(t){return"number"==typeof this.data&&(this.data+=t||1,this.base.autorender()),this},t.Effect.prototype.decrease=function(t){return this.increase(-t||-1)},s("desaturate",function(t){t/=100,o.call(this,t)}),s("saturate",function(t){t=-t/100,o.call(this,t)}),s("lighten",function(t){t/=100,h.call(this,t)}),s("darken",function(t){t=-t/100,h.call(this,t)}),s("opacity",function(t){t/=100;this.base;this.context.loop(function(e,i,n){return n.a*=t,n})}),c.mul_shift_table=function(t){var e=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265,497,469,443,421,25,191,365,349,335,161,155,149,9,278,269,261,505,245,475,231,449,437,213,415,405,395,193,377,369,361,353,345,169,331,325,319,313,307,301,37,145,285,281,69,271,267,263,259,509,501,493,243,479,118,465,459,113,446,55,435,429,423,209,413,51,403,199,393,97,3,379,375,371,367,363,359,355,351,347,43,85,337,333,165,327,323,5,317,157,311,77,305,303,75,297,294,73,289,287,71,141,279,277,275,68,135,67,133,33,262,260,129,511,507,503,499,495,491,61,121,481,477,237,235,467,232,115,457,227,451,7,445,221,439,218,433,215,427,425,211,419,417,207,411,409,203,202,401,399,396,197,49,389,387,385,383,95,189,47,187,93,185,23,183,91,181,45,179,89,177,11,175,87,173,345,343,341,339,337,21,167,83,331,329,327,163,81,323,321,319,159,79,315,313,39,155,309,307,153,305,303,151,75,299,149,37,295,147,73,291,145,289,287,143,285,71,141,281,35,279,139,69,275,137,273,17,271,135,269,267,133,265,33,263,131,261,130,259,129,257,1],i=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13,14,14,14,14,10,13,14,14,14,13,13,13,9,14,14,14,15,14,15,14,15,15,14,15,15,15,14,15,15,15,15,15,14,15,15,15,15,15,15,12,14,15,15,13,15,15,15,15,16,16,16,15,16,14,16,16,14,16,13,16,16,16,15,16,13,16,15,16,14,9,16,16,16,16,16,16,16,16,16,13,14,16,16,15,16,16,10,16,15,16,14,16,16,14,16,16,14,16,16,14,15,16,16,16,14,15,14,15,13,16,16,15,17,17,17,17,17,17,14,15,17,17,16,16,17,16,15,17,16,17,11,17,16,17,16,17,16,17,17,16,17,17,16,17,17,16,16,17,17,17,16,14,17,17,17,17,15,16,14,16,15,16,13,16,15,16,14,16,15,16,12,16,15,16,17,17,17,17,17,13,16,15,17,17,17,16,15,17,17,17,16,15,17,17,14,16,17,17,16,17,17,16,15,17,16,14,17,16,15,17,16,17,17,16,17,15,16,17,14,17,16,15,17,16,17,13,17,16,17,17,16,17,14,17,16,17,16,17,16,17,9];return[e[t]||e[e.length-1],i[t]||i[i.length-1]]},s("blur",function(t){if(isNaN(t)||1>t)return this;t=Math.round(t);var e=2,i=this.base.width(),n=this.base.height(),r=i-1,a=n-1,s=t+1,o=2*t+1,h=c.mul_shift_table(t)[0],l=c.mul_shift_table(t)[1],u=e,f=this.context.getImageData();if(f){var d,p,g,y,m,v,x,b,E,w,z,k,I,L,X,Y,T,C=f.data,P=new c,M=P;for(g=1;o>g;g++)M=M.next=new c,g===s&&(Y=M);for(M.next=P,T=null;u-->0;){for(x=v=0,p=n;--p>-1;){for(b=s*(k=C[v]),E=s*(I=C[v+1]),w=s*(L=C[v+2]),z=s*(X=C[v+3]),M=P,g=s;--g>-1;)M.r=k,M.g=I,M.b=L,M.a=X,M=M.next;for(g=1;s>g;g++)y=v+((g>r?r:g)<<2),b+=M.r=C[y],E+=M.g=C[y+1],w+=M.b=C[y+2],z+=M.a=C[y+3],M=M.next;for(T=P,d=0;i>d;d++)C[v++]=b*h>>>l,C[v++]=E*h>>>l,C[v++]=w*h>>>l,C[v++]=z*h>>>l,y=x+((y=d+t+1)<r?y:r)<<2,b-=T.r-(T.r=C[y]),E-=T.g-(T.g=C[y+1]),w-=T.b-(T.b=C[y+2]),z-=T.a-(T.a=C[y+3]),T=T.next;x+=i}for(d=0;i>d;d++){for(v=d<<2,b=s*(k=C[v]),E=s*(I=C[v+1]),w=s*(L=C[v+2]),z=s*(X=C[v+3]),M=P,g=0;s>g;g++)M.r=k,M.g=I,M.b=L,M.a=X,M=M.next;for(m=i,g=1;t>=g;g++)v=m+d<<2,b+=M.r=C[v],E+=M.g=C[v+1],w+=M.b=C[v+2],z+=M.a=C[v+3],M=M.next,a>g&&(m+=i);for(v=d,T=P,p=0;n>p;p++)y=v<<2,C[y+3]=X=z*h>>>l,X>0?(X=255/X,C[y]=(b*h>>>l)*X,C[y+1]=(E*h>>>l)*X,C[y+2]=(w*h>>>l)*X):C[y]=C[y+1]=C[y+2]=0,y=d+((y=p+s)<a?y:a)*i<<2,b-=T.r-(T.r=C[y]),E-=T.g-(T.g=C[y+1]),w-=T.b-(T.b=C[y+2]),z-=T.a-(T.a=C[y+3]),T=T.next,v+=i}}this.context.putImageData(f)}}),t.registerEffect("invert",function(){this.context.loop(function(t,e,i){return i.r=255-i.r,i.g=255-i.g,i.b=255-i.b,i})});var g=["click","mouseover","mousemove","mouseenter","mouseleave","mouseout","mousedown","mouseup"];g.forEach(function(e){t.prototype[e]=function(t){var i=l(this,t,e);return this.canvas.addEventListener(e,i.exec),this}}),t.prototype.on=function(t,e){return t=t.split(" "),t.forEach(function(t){var i=l(this,e,t);g.indexOf(t)>-1&&this.canvas.addEventListener(t,i.exec)},this),this},["width","height"].forEach(function(e){t.prototype[e]=function(t,i){return t?(this.canvas[e]=t,this.layers.forEach(function(n){n[e](t,i)}),this):this.canvas[e]},t.Layer.prototype[e]=function(i,n){var r;return i?(i=this["normalize"+("width"===e?"X":"Y")](i),t.utils.forEach(this.elements,function(t){t.canvas[e]=i}),r=n?i/this.canvas[e]:1,n&&("width"===e&&(this.scale.x*=r),"height"===e&&(this.scale.y*=r),this.canvas[e]=i),this.base.autorender(),this):this.canvas[e]}}),this.Martin=t}();
//# sourceMappingURL=martin.min.js.map