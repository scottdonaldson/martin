!function(){window.Martin=function(a){if("string"==typeof a&&(a={id:a}),this.obj=a,this.original=document.getElementById(a.id),!this.original)return!1;this.original.onload=this.handleLoad()},Martin.prototype.handleLoad=function(){return this.canvas=this.convertToCanvas(),this.canvas?(this.context=this.canvas.getContext("2d"),this.obj.background&&this.rect(0,0,"100%","100%",this.obj.background),this):!1},Martin.prototype.convertToCanvas=function(){var a=document.createElement("canvas");return a.width=this.original.width,a.height=this.original.height,a.getContext("2d").drawImage(this.original,0,0),this.original.style.display="none",this.original.parentNode.insertBefore(a,this.original),a},Martin.prototype.normalizePercentX=function(a){return a/100*this.canvas.width},Martin.prototype.normalizePercentY=function(a){return a/100*this.canvas.height},Martin.prototype.rect=function(a,b,c,d,e){var f=this,g={offsetX:a,offsetY:b,width:c,height:d},h=0;for(var i in g)"string"==typeof g[i]&&"%"===g[i].slice(-1)&&(g[i]=h%2===0?f.normalizePercentX(+g[i].slice(0,-1)):f.normalizePercentY(+g[i].slice(0,-1))),h++;return this.context.fillStyle=e,this.context.fillRect(g.offsetX,this.canvas.height-g.offsetY-g.height,g.width,g.height),this},Martin.prototype.polygon=function(a,b){this.context.fillStyle=b,this.context.beginPath();for(var c=0;c<a.length;c++){var d="string"==typeof a[c][0]&&"%"===a[c][0].slice(-1)?this.normalizePercentX(a[c][0].slice(0,-1)):a[c][0],e="string"==typeof a[c][1]&&"%"===a[c][1].slice(-1)?this.normalizePercentY(a[c][1].slice(0,-1)):a[c][1];0===c&&this.context.moveTo(d,this.canvas.height-e),this.context.lineTo(d,this.canvas.height-e)}return this.context.closePath(),this.context.fill(),this},Martin.prototype.toBW=function(){for(var a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),b=a.data,c=b.length,d=0;c>d;d+=4){var e=.3*b[d]+.59*b[d+1]+.11*b[d+2];b[d]=e,b[d+1]=e,b[d+2]=e}return this.context.putImageData(a,0,0),this},Martin.prototype.lighten=function(a){for(var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=b.data,d=c.length,e=0;d>e;e+=4)c[e]+=Math.round(256*a/100),c[e+1]+=Math.round(256*a/100),c[e+2]+=Math.round(256*a/100);return this.context.putImageData(b,0,0),this},Martin.prototype.darken=function(a){return this.lighten(-a)},Martin.prototype.convertToImage=function(){var a=new Image;a.src=this.canvas.toDataURL(),this.canvas.style.display="none",this.canvas.parentNode.insertBefore(a,this.canvas)}}();