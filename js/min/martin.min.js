!function(){function a(a){if(!a)return!1;"#"===a.slice(0,1)&&(a=a.slice(1));var b,c,d;return 6===a.length?(b=a.slice(0,2),c=a.slice(2,4),d=a.slice(4,6)):3===a.length&&(b=a.slice(0,1)+a.slice(0,1),c=a.slice(1,2)+a.slice(1,2),d=a.slice(2,3)+a.slice(2,3)),console.log(b,c,d),{r:parseInt(b,16),g:parseInt(c,16),b:parseInt(d,16)}}window.Martin=function(a){return a?(this.original=document.getElementById(a),this.original?void(this.original.onload=this.handleLoad()):!1):!1},Martin.prototype.handleLoad=function(){return this.canvas=this.makeCanvas(),this.canvas?(this.context=this.canvas.getContext("2d"),this):!1},Martin.prototype.makeCanvas=function(){if("IMG"===this.original.tagName){var a=document.createElement("canvas");return a.width=this.original.width,a.height=this.original.height,a.getContext("2d").drawImage(this.original,0,0),this.original.style.display="none",this.original.parentNode.insertBefore(a,this.original),a}return"CANVAS"===this.original.tagName?this.original:!1},Martin.prototype.width=function(a){var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);return this.canvas.width=a,this.context.putImageData(b,0,0),this},Martin.prototype.height=function(a){var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);return this.canvas.height=a,this.context.putImageData(b,0,0),this},Martin.prototype.normalizePercentX=function(a){return a/100*this.canvas.width},Martin.prototype.normalizePercentY=function(a){return a/100*this.canvas.height},Martin.prototype.background=function(b){for(var c=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),d=c.data,e=d.length,f=a(b),g=f.r,h=f.g,i=f.b,j=0;e>j;j+=4)if(d[j+3]<255){var k=d[j+3]/255;d[j]=((1+k)*d[j]+g)/(1+k),d[j+1]=((1+k)*d[j+1]+h)/(1+k),d[j+2]=((1+k)*d[j+2]+i)/(1+k),d[j+3]=255}return this.context.putImageData(c,0,0),this},Martin.prototype.rect=function(a,b,c,d,e,f){var g=this,h={offsetX:a,offsetY:b,width:c,height:d},i=0;for(var j in h)"string"==typeof h[j]&&"%"===h[j].slice(-1)&&(h[j]=i%2===0?g.normalizePercentX(+h[j].slice(0,-1)):g.normalizePercentY(+h[j].slice(0,-1))),i++;return this.context.fillStyle=e||"#000",this.context.globalAlpha=f||1,this.context.fillRect(h.offsetX,this.canvas.height-h.offsetY-h.height,h.width,h.height),this},Martin.prototype.circle=function(a,b,c,d,e){var f="string"==typeof a&&"%"===a.slice(-1)?this.normalizePercentX(+a.slice(0,-1)):a,g="string"==typeof b&&"%"===b.slice(-1)?this.normalizePercentY(+b.slice(0,-1)):b;return this.context.beginPath(),this.context.fillStyle=d||"#000",this.context.globalAlpha=e||1,this.context.arc(f,this.canvas.height-g,c,0,2*Math.PI,!1),this.context.fill(),this},Martin.prototype.polygon=function(a,b,c){this.context.fillStyle=b||"#000",this.context.globalAlpha=c||1,this.context.beginPath();for(var d=0;d<a.length;d++){var e="string"==typeof a[d][0]&&"%"===a[d][0].slice(-1)?this.normalizePercentX(a[d][0].slice(0,-1)):a[d][0],f="string"==typeof a[d][1]&&"%"===a[d][1].slice(-1)?this.normalizePercentY(a[d][1].slice(0,-1)):a[d][1];0===d&&this.context.moveTo(e,this.canvas.height-f),this.context.lineTo(e,this.canvas.height-f)}return this.context.closePath(),this.context.fill(),this},Martin.prototype.toBW=function(){for(var a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),b=a.data,c=b.length,d=0;c>d;d+=4){var e=.3*b[d]+.59*b[d+1]+.11*b[d+2];b[d]=e,b[d+1]=e,b[d+2]=e}return this.context.putImageData(a,0,0),this},Martin.prototype.lighten=function(a){for(var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=b.data,d=c.length,e=0;d>e;e+=4)c[e]+=Math.round(256*a/100),c[e+1]+=Math.round(256*a/100),c[e+2]+=Math.round(256*a/100);return this.context.putImageData(b,0,0),this},Martin.prototype.darken=function(a){return this.lighten(-a),this},Martin.prototype.convertToImage=function(){var a=new Image;a.src=this.canvas.toDataURL(),this.canvas.style.display="none",this.canvas.parentNode.insertBefore(a,this.canvas)}}();